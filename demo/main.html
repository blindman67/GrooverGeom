<!DOCTYPE html>
<html id="topDoc">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-8">
        <title>GrooverGeom demo</title>
        <meta name="keywords" content="Geometry, Math, JavaScript, Mark Spronck, Groover, GrooverGeom" />
        <meta name="description" content="Example for the use of GrooverGeom.js. GrooverGeom is a Javascript geometry libarry" />
        <meta name="author" content="Mark Spronck" />
        <link rel="stylesheet" type="text/css" href="grooverGeomDemo.css">
        <script>const GROOVER_GEOM_INCLUDE_MATH = true; // adds extensions to the built in Javascript Math object
        </script>
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/GrooverGeom.js"></script>
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/GrooverGeom_ExtendRender.js"></script>
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/GrooverGeom_ExtendShapes.js"></script>       
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/GrooverGeom_ExtendConstructors.js"></script>       
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/GrooverGeom_ExtendUI.js"></script>       
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/demo/mouse.js"></script>       
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/demo/imageTools.js"></script>       
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/demo/creationMenu.js"></script>       
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/demo/toolsMenu.js"></script>       
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/demo/demo.js"></script>       
        
        
    </head>
    <body class = "snug">
        <div class="title snug" id="title">
            <h1 class="snug" >Groover Vector Geometry Editor</h1>
            <p class = "helpText" id = "helpText">Welcome to the demo of Groover.Geom in action.</p>
        </div>
        <div class="content snug">
            <table id="workspace">
                <tbody>
                <tr>
                    <td>
                        <canvas class="canvas snug" id="toolsCanvas" ></canvas>
                    </td>
                    <td>
                        <canvas class="canvas snug" id="mainCanvas" ></canvas>
                    </td>
                    <td class="menu snug" id="menu_cell">
                        <p>Command Menu</p>
                        <div class="uiGroup" id="creation-UI">
                        <span class="uiGroupName" id="circle-group-name">Create</span>
                        <input class="uiButton" type="button" value="Vec"></input>
                        <input class="uiButton" type="button" value="Line"></input>
                        <input class="uiButton" type="button" value="Triangle"></input>
                        <input class="uiButton" type="button" value="Rectangle"></input>
                        <input class="uiButton" type="button" value="Circle"></input>
                        <input class="uiButton" type="button" value="Arc"></input>

                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="footer snug" id="foot">
        Powered by Groover.<small>This is a work in progress.</small>
        
        </div>
        <script>
        "use strict";
        const FONT = "arial";
        const CROSSHAIR = {
            colour : "rgba(255,255,45,0.6)",
            fontSize : 10,
        }
        const GEOM_UI_STYLES = {
            selectingBox : {
                colour : "rgba(255, 255, 255,0.6)",
                fill : "rgba(0,128,200,0.2)",                
                lineWidth : 1,
            },
            nearMouse : {
                mark : "circle",
                markSize : 10,
                colour : "red",
                fill : "rgba(0,8,20,0.1)",
                lineWidth : 1,
            },
            unselected : {
                mark : "cross",
                markSize : 5,
                colour : "#49F",
                lineWidth : 1,
            },
            bounds : {
                highlight : { 
                    colour : "rgba(255,255,0,0.9)",
                    lineWidth : 2,
                    mark : "box",
                    markSize : 10,
                },
                normal : {
                    colour : "rgba(255,200,0,0.5)",
                    lineWidth : 1,
                    mark : "box",
                    markSize : 7,
                },
            },
            selected : {
                mark : "crossDiag",
                markSize : 8,
                colour : "#F70",
                lineWidth : 2,
            },
            lables : {
                fill : "white",
                fontSize : 18,
            },
            geometry : {
                normal : {
                    colour : "green",
                    lineWidth : 4,
                },
                highlight : {
                    colour : "#0F0",
                    lineWidth : 4,
                },
            }
        }
        
        
        const MENU_WIDTH = 300;
        const TOOLBAR_WIDTH = 40;
        const FOOT = {
            height : 50,
        };
        const TITLE = {
            height : 100,
        }
        var canvas,ctx,workspace,title,foot,toolsCanvas,menu,helpText;
        var canWidth;
        var canHeight;
        var updateCanvas = true;
        var helpTips = [
            "Tip: Click drag middle mouse button to pan.",
            "Tip: Use mouse wheel to zoom in and out.",
            "Tip: Right click adds a point or if over a point selects a point. A point is a Groover.Geom.Vec ",
        ];
        var helpTimer
        function layout(){
            var w = window.innerWidth;
            var h = window.innerHeight;
            title.style.height = TITLE.height + "px";
            foot.style.height = FOOT.height + "px";
            menu.style.maxHeight = workspace.style.height = (h - FOOT.height - TITLE.height) + "px";
            toolsCanvas.width = TOOLBAR_WIDTH;
            canWidth = canvas.width = w - MENU_WIDTH - TOOLBAR_WIDTH;
            toolsCanvas.height = canHeight = canvas.height = workspace.offsetHeight;
            ctx = canvas.getContext("2d");
            updateCanvas = true;
            demo.start(toolsCanvas);
        }
        var page_UID = 0;
        function createElement(type,data){
            var el = document.createElement(type);
            el.id = data.id !== undefined ? data.id + "_"+(page_UID++) : "geomElement_"+(page_UID ++);
            el.className = data.className !== undefined ? data.className : "unknwn";
            if(data.type !== undefined){
                el.type = data.type;
            }
            if(data.text !== undefined){
                el.textContent = data.text;
            }
            return el;
        }
        function clearPrimitiveHighlight(lightType){
            var prims = document.querySelectorAll(".uiGroup");
            for(var i = 0; i < prims.length; i ++){
                prims[i].className = prims[i].className.replace(" "+lightType,"");                
            }
        }
        function primitiveHighlight(type,id,lightType,off){
            //var prims = document.querySelectorAll(".uiGroup");
            type = "primitiveUI_"+type.toLowerCase()+"_"+id;
            var prims = document.querySelector("#"+type);
            if(prims !== null){
                if(off){
                    prims.className = prims.className.replace(" "+lightType,"");                                
                }else
                if(prims.className.indexOf(" "+lightType) === -1){
                    prims.className += " "+lightType;
                 }
            }
            /*
            for(var i = 0; i < prims.length; i ++){
                if(prims[i].id === type){
                    if(prims[i].className.indexOf(" highlight") === -1){
                        prims[i].className += " highlight";
                     }
                }
            }*/
        }
        function openCloseNode(node,close){
             if(close){
                node.className = node.className.replace(" show"," closed");
             }else{
                node.className = node.className.replace(" closed"," show");
             }        
        }
        function subGroupOpenClose(event,node,state){
            var nodes;
            if(node === undefined){
                node = this;
                if(this.dataCloseLocal === true){
                    nodes = this.parentNode.children;
                }else{
                    nodes = this.parentNode.parentNode.children;
                }
            }else{
                nodes = node.parentNode.children;
            }
            var stateOpen = state === undefined ? undefined : state;
            for(var i = 0; i < nodes.length; i ++){
                if(nodes[i].className.indexOf("closed") > -1  || nodes[i].className.indexOf("show") > -1){
                    if(stateOpen === undefined){
                        if(nodes[i].className.indexOf("closed") === -1){
                            stateOpen = true;
                         }else{
                            stateOpen = false;
                         }
                     }
                     openCloseNode(nodes[i],stateOpen);
                }
            }
            if(stateOpen === true){
                node.textContent = "-";
            }else
            if(stateOpen === false){
                node.textContent = "+";
            }
        }
        function groupOpenClose(){
            var nodes = this.parentNode.parentNode.children;
            var stateOpen;
            for(var i = 0; i < nodes.length; i ++){
                if(nodes[i].className.indexOf("closed") > -1  || nodes[i].className.indexOf("show") > -1){
                    if(stateOpen === undefined){
                        if(this.textContent.indexOf("-") === -1){
                            stateOpen = false;
                            this.textContent = "-Sub";
                         }else{
                            stateOpen = true;
                            this.textContent = "+Sub";
                         }
                     }
                     var node = nodes[i].querySelector(".openClose");
                     if(node !== null){
                        subGroupOpenClose(undefined,node,stateOpen);
                     }
                 }
             }
        }        
        function createOpenCloseButton(closeLocal){
             var openClose = document.createElement("span");
             openClose.textContent = "+";
             openClose.className = "uiSubGroup openClose";
             if(closeLocal){
                openClose.dataCloseLocal = true;
             }
             openClose.addEventListener("click",subGroupOpenClose);
             return openClose;
        }
        function createOpenCloseSubGroupButton(){
             var openClose = document.createElement("span");
             openClose.textContent = "+Sub";
             openClose.className = "uiSubGroup openClose";
             openClose.addEventListener("click",groupOpenClose);
             return openClose;
        }
        function getSubGroup(subGroup,container){
            var subGroupE = container.querySelector("#"+ subGroup);
            if(subGroupE === null){
                 subGroupE = document.createElement("div");
                 subGroupE.className = "uiSubGroup primitiveType";
                 subGroupE.id = subGroup;   
                 var head = document.createElement("div");
                 head.className = "uiSubGroup name";
                 var openClose = createOpenCloseButton();
                 head.appendChild(openClose);
                 var openCloseSub = createOpenCloseSubGroupButton();
                 head.appendChild(openCloseSub);
                 var name = document.createElement("span");
                 name.textContent += subGroup;
                 head.appendChild(name);
                 subGroupE.appendChild(head);
                 container.appendChild(subGroupE);
            }
            return subGroupE;        
        }        
        function addMenuElement(element, subGroupName){
            var menuCell = document.querySelector("#menu_cell");
            var subG = getSubGroup(subGroupName,menuCell);
            var menuItem = document.querySelector("#"+element.id);
            if(menuItem !== null){
                subG.removeChild(menuItem);
            }
            element.className = element.className.replace(" closed"," show");
            if(element.className.indexOf(" show")=== -1){
                element.className += " show";
            }            
            subG.appendChild(element);
            
         }   
        function displayHelp(text){
            var n;
            clearTimeout(helpTimer);
            if(text === undefined && helpTips.length > 0){
                n = Math.floor(Math.random() * helpTips.length);
                text = helpTips[n];
                helpTips.splice(n,1);
            }
            helpText.textContent = text;
            if(helpTips.length > 0){
                helpTimer = setTimeout(displayHelp,13000);
            }
        }
        function showHelp(){
            if(this.title !== undefined && this.title !== null){
                displayHelp(this.title);
            }        
        }
        function addMenuItem(id,items,callback){
            var menuCell = document.querySelector("#menu_cell");
            var menuItem = menuCell.querySelector("#"+ id);
            if(menuItem !== null){ // remove the old one`
                menuCell.removeChild(menuItem);
             }
             menuItem = document.createElement("div");
             menuItem.className = "uiGroup";
             menuItem.id = id;
             items.forEach(function(item){
                 var el;
                 if(item.type === "text"){
                     el = document.createElement("span");
                     el.className = "uiGroupName";
                     el.textContent = item.text;
                 }else
                 if(item.type === "button"){
                     el = document.createElement("input");
                     el.className = "uiButton";
                     el.type = "button";
                     el.value= item.text;
                     el.id = "uiGroup_" + id +" _ "+item.text;
                     el.title = item.help;
                  }
                  item.element = el;
                  el.uiItem = item;
                  menuItem.appendChild(el);
             });
             menuCell.appendChild(menuItem);
             items.forEach(function(item){
                item.element.addEventListener("click",callback);
                if(item.type === "button"){
                    item.element.addEventListener("mouseover",showHelp);
                }
             });
        }
        function windowResize(){
            layout();
        }
        function pageLoaded(){
            canvas = document.querySelector("#mainCanvas");
            workspace = document.querySelector("#workspace");
            menu =  document.querySelector("#menu_cell");
            title = document.querySelector("#title");
            foot = document.querySelector("#foot");
            toolsCanvas = document.querySelector("#toolsCanvas");
            helpText = document.querySelector("#helpText");
            window.addEventListener("resize",windowResize);
            windowResize();
        
        }
        window.addEventListener("load",pageLoaded);
        </script>
    </body>
</html>





