<!DOCTYPE html>
<html id="topDoc">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-8">
        <title>Example template</title>
        <meta name="keywords" content="Geometry, Math, JavaScript, Mark Spronck, Groover, GrooverGeom" />
        <meta name="description" content="Example for the use of GrooverGeom.js. GrooverGeom is a Javascript geometry libarry" />
        <meta name="author" content="Mark Spronck" />
        <link rel="stylesheet" type="text/css" href="grooverGeomExamples.css">
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/GrooverGeom.js"></script>
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/GrooverGeom_ExtendRender.js"></script>
        <script src = "http://localhost/MarksHome/GitHub/GrooverGeom/GrooverGeom_ExtendShapes.js"></script>       
    </head>
    <body>
    <h1 class="exampleH1" >GrooverGeom Example</h1>
    <h2 class="exampleH2" >Primitive: groover.geom.VecArray</h2>
    <div>
        <p>Uses primitives Vec and VecArray and rendered with render extention that is added via groover.geom.addRender(). To set the current context use groover.geom.setCtx(context).</p>
        <p>The render extention adds the following functions to each primitive
            <ul>
                <li>primitive.moveTo()  moves the current path to the start of the primitive.</li>
                <li>primitive.lineTo()  creates a line to the start of the primitive.</li>
                <li>primitive.draw() creates a path that represents the primitive.</li>
                <li>primitive.mark() adds marks to the current path to display primitive's defining points.</li>
                <li>primitive.lable(text) display a text lable, text is optional, if omited then will use the lable set by primitive.setLable(text), if that us undefined then will lable the primitive with its type. </li>
            </ul>
        
        </p>
        
        <table>
            <tr>
                <td>
                    <canvas class="exampleCanvas" id="mainCanvas" width = 500 height = 500></canvas>
                </td>
                <td>
                    <p>Move mouse over points and click drag to move them</p>
                    Info:
                    <ul>
                        <li>Mouse coords <span id="mouseCoords"></span></li>
                        <li>Mouse near index <span id="mouseNear"></span></li>
                        <li>
                            <span id="markerTypes"></span>
                        </li>
                    </ul>
                </td>
            </tr>
        </table>
    </div>
    
    
    <a  class="exampleA" href="index.html">Return to main</a>
    <script src = "mouse.js"></script>
    <script src = "imageHelper.js"></script>
    <script src = "domHelper.js"></script>
    
    <script>
    "use strict";
    // set up GrooverGeom.    
    if(typeof groover.geom.addRender === "function"){
        groover.geom.addRender(); // add render extention if it exists
    }
    if(typeof groover.geom.addShapes === "function"){
        groover.geom.addShapes(); // add shape extention if it exists
    }    
    

    var GG = groover.geom; // shortcut to groover.geom
    
    var canvas,ctx,w,h;
    var mouseV = new GG.Vec(); // create a point for the mouse
    var dragOffset = new GG.Vec();  // distance from mouse to point
    var dragPoints = new GG.VecArray(); // create a vec array to hold draggable points.
    var closePointIndex = undefined;  // index of cloest drag point
    var currentDragPoint = undefined;
    const SELECT_DIST = 10; // distance from point to be selected
    var background = undefined;
    var mouseInfoEl = $("#mouseCoords");
    var mouseNearEl = $("#mouseNear");
    var currentMarkType = "circle";
    var markNameSet = function(event){
        currentMarkType = this.value;
        console.log(this);
    }
        
    var markerTypeList = addRadioGroup(GG.markNames,"#markerTypes",null,"circle",markNameSet);
    
    function update(time){
        // put in the request for next frame
        requestAnimationFrame(update);
        // set the mouse Vec to the mouse position.
        mouseV.setAs(mouse.x,mouse.y);

        // clean transform
        ctx.setTransform(1,0,0,1,0,0);
        // clear the canvas
        ctx.drawImage(background,0,0);
        
        // handle drag points
        closePointIndex = dragPoints.findClosestIndex(mouseV, SELECT_DIST); // find the closest point to the mouse
        // if mouse B1 is down then draging make sure there is a point to drag
        if(mouse.buttonRaw === 1 && (closePointIndex !== -1 || currentDragPoint !== undefined)){
            if(currentDragPoint === undefined){  // set the current drag point
                currentDragPoint = closePointIndex;
                dragOffset.setAs(mouseV).sub(dragPoints.vecs[currentDragPoint]); // get the drag offset
            }
            dragPoints.vecs[currentDragPoint].setAs(mouseV).sub(dragOffset); // update that point
        }else{
            currentDragPoint = undefined;  // undefine the drag index        
        }
        mouseNearEl.textContent = currentDragPoint !== undefined ? currentDragPoint : (closePointIndex === -1 ? "none" : closePointIndex);
        
        mouseInfoEl.textContent = mouseV.toString(0);
        
        // display the mouse vector
        beginStyle("blue","Red",1)
        GG.setMark(currentMarkType);
        GG.setMarkSize(4);
        mouseV.mark();
        ctx.stroke();
        
        // display all drag points
        beginStyle("blue","black",3)
        GG.setMarkSize(8 + Math.sin(time/100)* 2);      // set the current point size
        dragPoints.mark();     // mark all the points in dragPoints
        ctx.stroke();          // render them
        beginStyle("blue","Red",2)
        dragPoints.mark();     // mark all the points in dragPoints
        ctx.stroke();          // render them
        

        
        // highlite the drag point
        if(closePointIndex > -1 || currentDragPoint !== undefined ){
            beginStyle("white","Red",2)
            GG.setMarkSize(10);      // set the current point size
            dragPoints.vecs[currentDragPoint !== undefined ? currentDragPoint : closePointIndex].mark();     // mark the points in dragPoints
            ctx.stroke();          // render them
            ctx.fill();          // render them
        
        }
        beginFontStyle("arial",16,"black","center","middle");
        dragPoints.lable();   
    }
    function start(){
        var v;
        canvas = document.getElementById("mainCanvas");
        ctx = canvas.getContext("2d");
        w = canvas.width;
        h = canvas.height;
        if(typeof GG.setCtx === "function"){
            GG.setCtx(ctx);
        }
        mouse.startMouse(canvas);
        background = createImage(w,h);
        drawGrid(background, 4, 20, "#aaa", "#000");
        for(var i = 0; i < 10 ; i += 1){ // add some test points
            dragPoints.push(v = new GG.Vec(Math.random() * w,Math.random() * h));
            v.setLable(i);
        }
        
        update();
    
    }
    window.addEventListener("load",start);
    </script>
    </body>
</html>